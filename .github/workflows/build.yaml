name: Build Firmware

on:
  push:
    branches:
      - main    # 或者你希望触发构建的分支
  pull_request:
    branches:
      - main    # 或者你希望触发构建的分支

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v2

    - name: Set up Docker (optional, if you want to build inside Docker)
      uses: docker/setup-buildx-action@v1

    - name: Set up the environment
      run: |
        sudo apt-get update
        sudo apt-get install -y build-essential libncurses5-dev zlib1g-dev gawk flex git wget
        # 添加其他依赖，如编译工具和交叉编译器，取决于你需要的环境

    - name: Copy config file
      run: |
        cp configs/.config .  # 复制配置文件到编译目录

    - name: Start build
      run: |
        make defconfig  # 初始化配置
        make -j12  # 开始编译，指定使用的 CPU 核心数

    - name: Upload firmware
      uses: actions/upload-artifact@v2
      with:
        name: firmware
        path: ./bin/  # 上传编译后的固件
